<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stafa leitin!</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <!-- Use Thymeleaf's JavaScript inlining -->
    <script th:inline="javascript">
        // Extract Thymeleaf variables into JavaScript
        const correctId = [[${correctId}]];
        const optionIds = [[${optionIds}]];
        const level = [[${level}]]; // Extract the level

        // Function to play audio
        function playAudio() {
            const audio = new Audio('/playAudio?id=' + correctId);
            audio.play();
        }

        async function checkAnswer(selectedId) {
            if (selectedId === correctId) {
                alert('Húrra! Vel gert!');
                document.getElementById('nextGame').style.display = 'block'; // Show "Aftur" button

                // Notify backend about the correct answer
                await fetch('/letters/answer', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams({ correct: true })
                });

                // Update the level display
                await updateLevelDisplay();
            } else {
                alert('Reyndu aftur!');
            }
        }

        async function updateLevelDisplay() {
            const response = await fetch('/letters/current-level', {
                method: 'GET'
            });

            if (response.ok) {
                const data = await response.json();
                document.getElementById('levelDisplay').textContent = data.level;
            }
        }
    </script>
</head>
<body>
<h1>Stafa leitin!</h1>
<p>Level: <span id="levelDisplay" th:text="${level}">1</span></p> <!-- Add level display -->
<button class="back-button" onclick="location.href='/'">⬅️ Til baka</button>
<p>Ýttu stafinn sem þú heyrir í!</p>
<button type="button" onclick="playAudio()">Hlusta</button>

<!-- Displaying options -->
<div id="optionsContainer"></div>

<!-- "Aftur" button for restarting -->
<div id="nextGame" style="display: none;">
    <button onclick="location.reload()">Aftur!</button>
</div>

<!-- Adding a script to create buttons dynamically -->
<script th:inline="javascript">
    // Function to render buttons with image options
    function renderOptions() {
        const optionsContainer = document.getElementById('optionsContainer');
        const correctId = [[${correctId}]];
        const optionIds = [[${optionIds}]];

        optionIds.forEach(id => {
            // Create a button element
            const button = document.createElement('button');
            button.type = 'button';

            // Set onclick function for button
            button.onclick = () => checkAnswer(id);

            // Create an img element
            const img = document.createElement('img');
            img.src = '/getImage?id=' + id;
            img.alt = 'Option Image';

            // Append img to button, and button to container
            button.appendChild(img);
            optionsContainer.appendChild(button);
        });
    }

    // Call the function to render options
    renderOptions();
</script>
</body>
</html>


